# neu_mon-iot-_network_traffic_analysis

This script performs network analysis to classify traffic as either first, support, third, or local party traffic.

## Setup

This script uses Python 3. The AdBlock parser is also needed: `pip install adblockparser`

## Usage
Usage: `python3 main.py -i PCAP_DIR -m MAC_ADDR -s IMC_DIR [OPTION]...`

Example: `python3 main.py -i echodot_pcaps/ -m 18:74:2e:41:4d:35 -s ../intl-iot/ -d Amazon`

## Input

There are several options to choose from, which are summarized below:

#### Requried arguments:

`-i PCAP_DIR` - The path to the directory containing input pcap files for analysis. All the pcap files in this directory should have been generated by the same device.

`-m MAC_ADDR` - The MAC address of the device that generated the data in `PCAP_DIR`.

`-s IMC_DIR` - The path to the main directory (`intl-iot/`) containing the code accompanying the paper titled "Information Exposure From Consumer IoT Devices: A Multidimensional, Network-Informed Measurement Approach" in proceedings of the ACM Internet Measurement Conference 2019 (IMC 2019). The code can be found here: https://github.com/NEU-SNS/intl-iot. Destination analysis is performed using this code.

#### Optional arguments:

`-d DEV_MFR` - The company that created the device that generated the data in `PCAP_DIR`. This is used to identify the first parties. Default is `unknown`.

`-f FIG_DIR` - The path to the directory where generated plots and other associated output will be placed. If this directory does not currently exist, it will be generated by the script. Default is `plots/`.

`-o OUT_CSV` - The path to the output CSV file containing the analysis. If the file does not exist, it will be generated. If it exists, the results will be appended. Default is `result.csv`.

## Output

When `main.py` is run, several files are outputted.

The main output is generated by the `-o` option. This CSV file contains an analysis of traffic in the input pcap files. There are eleven columns of analysis:

- `ip` - The IP address of the packets being analyzed.
- `host` - The second level domain name of an IP address.
- `host_full` - The full domain name, including any subdomains.
- `traffic_snd` - The number of bytes of packets sent.
- `traffic_rcv` - The number of bytes of packets received.
- `packet_snd` - The number of packets sent.
- `packet_rcv` - The number of packets received.
- `country` - The country code that the IP address belongs to. If not found, `XX` is displayed.
- `party` - The party that the traffic belongs to. Either first, support, third, or local party.
- `input_file` - The name of the input pcap file that contained the traffic being analyzed.
- `organization` - The organization that the IP address belongs to. If not found, `N/A` is displayed.

The script also generates several graphs:

- One graph, named `<DEV_MFR>_device_parties.png`, shows the percentage of first, support, third, and local party traffic from the input pcap files. The graph also shows the number of bytes of traffic from each party.

- For each party, a graph named `<DEV_MFR>_<party>_party_traffic.png` is produced. It shows the domain names and the percentage of traffic from that domain. If a party does not have traffic, no graph is produced for that party.

The script also generates:
- a text file, named `<DEV_MFR>_all_sld.txt`, which shows the second level domains of the device manufacturer.
- a CSV file, named `<DEV_MFR>_tmp.csv`, which is a temporary file containing the output of running the destination analysis from the IMC'19 software.

